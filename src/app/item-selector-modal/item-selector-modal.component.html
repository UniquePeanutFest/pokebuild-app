<ion-header>
  <ion-toolbar>
    <ion-title size="small">
      {{ pokemon ? 'Seleccionar objeto para ' + pokemon.name : 'Seleccionar objeto' }}
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="confirmSelection()" [disabled]="!selectedItem" color="success">
        <ion-icon name="checkmark" slot="start"></ion-icon>
        Confirmar
      </ion-button>
      <ion-button *ngIf="currentItem" (click)="removeItem()" color="danger">
        <ion-icon name="trash" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button (click)="cancel()">
        <ion-icon name="close" slot="start"></ion-icon>
        Cancelar
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Barra de búsqueda -->
  <div class="search-container">
    <ion-searchbar placeholder="Buscar objeto" 
                   [(ngModel)]="searchTerm"
                   (ionInput)="onSearchInput($event)"
                   animated>
    </ion-searchbar>
  </div>

  <!-- Categorías de objetos -->
  <ion-segment [(ngModel)]="selectedCategory" (ionChange)="selectCategory(selectedCategory)">
    <ion-segment-button *ngFor="let category of itemCategories" [value]="category.id">
      <ion-label>{{ category.name }}</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Estado de carga -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="circular"></ion-spinner>
    <p>Cargando objetos...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error-container">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>{{ error }}</p>
  </div>

  <!-- Mensaje para mega-evoluciones -->
  <div *ngIf="isMegaEvolution" class="mega-evolution-warning">
    <ion-icon name="flash-outline" color="warning"></ion-icon>
    <p>Este Pokémon es una mega-evolución y no puede equipar items</p>
  </div>

  <!-- Lista de objetos -->
  <ion-list *ngIf="!isLoading && !error && filteredItems.length > 0">
    <ion-item *ngFor="let item of filteredItems" 
              [class.selected]="selectedItem && selectedItem.id === item.id"
              (click)="selectItem(item)">
      <ion-thumbnail slot="start" *ngIf="item.sprites?.default">
        <img [src]="item.sprites.default" alt="{{ getItemName(item) }}">
      </ion-thumbnail>
      <ion-label>
        <h2>{{ getItemName(item) }}</h2>
        <p>{{ getItemDescription(item) }}</p>
      </ion-label>
      <ion-icon 
        *ngIf="selectedItem && selectedItem.id === item.id" 
        name="checkmark-circle" 
        color="success" 
        slot="end">
      </ion-icon>
    </ion-item>
  </ion-list>

  <!-- Mensaje sin resultados -->
  <div *ngIf="!isLoading && !error && filteredItems.length === 0" class="empty-container">
    <ion-icon name="search-outline"></ion-icon>
    <p>No se encontraron objetos con los filtros actuales</p>
  </div>
</ion-content>
